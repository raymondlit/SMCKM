<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCS51单片机智慧教学平台知识图谱</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --primary-color: #e6f2ff;
            --secondary-color: #b3d9ff;
            --accent-color: #0077cc;
            --text-color: #333;
            --light-text: #666;
            --card-bg: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .header-content {
            padding: 0 20px;
        }
        
        .logo {
            font-size: 3em;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2.5em;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            color: var(--light-text);
        }
        
        .knowledge-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 2em;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .section-title span {
            font-size: 0.7em;
            color: var(--light-text);
            font-weight: normal;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            position: relative;
            flex: 1;
            max-width: 300px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text);
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #005a9e;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        .btn-outline:hover {
            background-color: var(--primary-color);
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        /* 图表颜色定义 */
        .node.hardware { fill: #4CAF50; }
        .node.software { fill: #FF9800; }
        .node.tool { fill: #9C27B0; }
        .node.application { fill: #795548; }
        .node.experiment { fill: #E91E63; }
        .node.project { fill: #607D8B; }
        .node.core { fill: #0077cc; }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 2px;
        }
        
        .link.highlighted {
            stroke: #ff7700;
            stroke-width: 3px;
        }
        
        .node-label {
            font-size: 12px;
            text-anchor: middle;
            fill: #333;
            pointer-events: none;
        }
        
        .node-label.hidden {
            display: none;
        }
        
        .knowledge-map-container {
            display: flex;
            gap: 20px;
        }
        
        #knowledge-graph {
            flex: 1;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background-color: #fdfdfd;
            margin-bottom: 30px;
        }
        
        .graph-info {
            width: 300px;
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 5px;
            overflow-y: auto;
        }
        
        .info-title {
            font-size: 1.3em;
            color: var(--accent-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }
        
        .detail-item {
            margin-bottom: 15px;
        }
        
        .detail-item h4 {
            color: var(--accent-color);
            margin-bottom: 8px;
        }
        
        .detail-item ul, .detail-item ol {
            padding-left: 20px;
        }
        
        .detail-item li {
            margin-bottom: 5px;
        }
        
        .learning-path {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .learning-path h5 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        /* 知识库主题分类卡片样式 */
        .knowledge-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .topic-card {
            flex: 1;
            min-width: 250px;
            background-color: var(--card-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .topic-card h3 {
            color: var(--accent-color);
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .topic-card h3 i {
            margin-right: 10px;
        }

        .topic-card ul {
            list-style: none;
            padding-left: 0;
        }

        .topic-card li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .topic-card li a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .topic-card li a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }
        
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
            border-radius: 10px;
        }
        
        .footer-links {
            margin-bottom: 15px;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--secondary-color);
        }
        
        .copyright {
            color: #ccc;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-microchip"></i>
                </div>
                <h1>MCS51单片机智慧教学平台</h1>
                <p class="subtitle">洛阳理工学院 电子信息学院出品 | 建议反馈: limeng@lit.edu.cn</p>
            </div>
        </header>
        
        <section class="knowledge-section">
            <h2 class="section-title">
                MCS51单片机知识图谱
            </h2>
            
            <div class="controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="搜索知识点...">
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-outline btn-small" id="reset-graph">重置视图</button>
                    <button class="btn btn-outline btn-small" id="zoom-in">放大</button>
                    <button class="btn btn-outline btn-small" id="zoom-out">缩小</button>
                    <button class="btn btn-outline btn-small" id="toggle-labels">显示/隐藏标签</button>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background-color: #0077cc;"></div> 核心概念</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #4CAF50;"></div> 硬件知识</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #FF9800;"></div> 软件知识</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #9C27B0;"></div> 开发工具</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #795548;"></div> 实际应用</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #E91E63;"></div> 实验项目</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #607D8B;"></div> 综合项目</div>
            </div>
            
            <div class="knowledge-map-container">
                <div id="knowledge-graph"></div>
                <div class="graph-info">
                    <h3 class="info-title">知识点详情</h3>
                    <div id="default-info">
                        <p>点击图谱中的节点查看详细信息。知识图谱展示了MCS51单片机的核心概念及其相互关系，包含硬件、软件、开发工具、实际应用、实验项目和综合项目。</p>
                        <div class="detail-item">
                            <h4>图谱使用指南</h4>
                            <ul>
                                <li>拖动节点可以重新布局</li>
                                <li>使用鼠标滚轮可以缩放</li>
                                <li>点击节点查看详细信息</li>
                                <li>使用搜索框查找特定概念</li>
                                <li>双击空白处重置高亮显示</li>
                            </ul>
                        </div>
                        <div class="learning-path">
                            <h5>个性化学习建议</h5>
                            <p>根据您的学习目标，知识图谱可以为您推荐学习路径。例如：</p>
                            <ul>
                                <li><strong>初学者</strong>: 从"单片机基础概念"开始，逐步学习硬件结构和C51编程</li>
                                <li><strong>实验学习者</strong>: 关注"实验项目"节点，结合实验内容学习相关知识点</li>
                                <li><strong>项目开发者</strong>: 关注"实际应用"和"系统设计"相关节点</li>
                                <li><strong>工具使用者</strong>: 重点学习"开发工具"分支，掌握Keil和Proteus的使用</li>
                            </ul>
                        </div>
                    </div>
                    <div id="node-details" class="node-details" style="display: none;">
                        <!-- 节点详情将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
            
            <h2 class="section-title">知识库主题分类</h2>
            
            <div class="knowledge-topics">
                <!-- 原始知识分类 -->
                <div class="topic-card">
                    <h3><i class="fas fa-microchip"></i> 硬件基础模块</h3>
                    <ul>
                         <li><a href="#basic">基础概念</a></li>
                         <li><a href="#memory">存储器系统</a></li>
                         <li><a href="#io">I/O端口</a></li>
                         <li><a href="#interrupt">中断系统</a></li>
                         <li><a href="#timer">定时器/计数器</a></li>
                         <li><a href="#serial">串行通信</a></li>
                    </ul>
                </div>
                
                <div class="topic-card">
                    <h3><i class="fas fa-code"></i> 软件编程模块</h3>
                    <ul>
                        <li><a href="#instruction">指令系统</a></li>
                        <li><a href="#c51">C51程序设计</a></li>
                        <li><a href="#addressing">寻址方式</a></li>
                        <li><a href="#data_types">数据类型</a></li>
                    </ul>
                </div>
                
                <div class="topic-card">
                    <h3><i class="fas fa-tools"></i> 开发工具链</h3>
                    <ul>
                        <li><a href="#keil">Keil开发环境</a></li>
                        <li><a href="#proteus">Proteus仿真</a></li>
                        <li><a href="https://www.keil.com/demo/eval/c51.htm">Keil C51 下载</a></li>
                        <li><a href="http://www.labcenter.com/downloads/">Proteus 下载</a></li>
                    </ul>
                </div>

                <div class="topic-card">
                    <h3><i class="fas fa-flask"></i> 实验项目</h3>
                    <ul>
                        <li><a href="#exp1">实验1: LED流水灯</a></li>
                        <li><a href="#exp2">实验2: 数码管计数显示</a></li>
                        <li><a href="#exp3">实验3: 文献检索与综述</a></li>
                        <li><a href="#exp4">实验4: 电子秒表显示器</a></li>
                        <li><a href="#exp5">实验5: 电子表LCD显示</a></li>
                        <li><a href="#exp6">实验6: 18B20温度检测</a></li>
                        <li><a href="#exp7">实验7: 直流数字电压表</a></li>
                        <li><a href="#exp8">实验8: 双机串行通信</a></li>
                    </ul>
                </div>

                 <div class="topic-card">
                    <h3><i class="fas fa-project-diagram"></i> 综合应用</h3>
                    <ul>
                        <li><a href="#proj1">项目1: 智能交通灯</a></li>
                         <li><a href="#proj2">项目2: 综合应用系统</a></li>
                         <li><a href="#design">系统设计</a></li>
                         <li><a href="#interface">接口技术</a></li>
                    </ul>
                </div>
            </div>
        </section>
        
        <footer>
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#">关于我们</a>
                    <a href="#">联系我们</a>
                    <a href="#">帮助中心</a>
                    <a href="#">隐私政策</a>
                </div>
                <p class="copyright">© 2025 洛阳理工学院电子信息学院. 保留所有权利.</p>
            </div>
        </footer>
    </div>

    <script>
        // 扩展的知识图谱数据 - 包含Proteus和Keil C51相关内容以及实验项目
        const knowledgeData = {
            nodes: [
                // 核心概念节点
                { id: "mcs51", name: "MCS51单片机", category: "core", level: 0 },
                
                // 主要知识领域
                { id: "basic", name: "基础概念", category: "hardware", level: 1 },
                { id: "memory", name: "存储器系统", category: "hardware", level: 1 },
                { id: "io", name: "I/O端口", category: "hardware", level: 1 },
                { id: "instruction", name: "指令系统", category: "software", level: 1 },
                { id: "interrupt", name: "中断系统", category: "hardware", level: 1 },
                { id: "timer", name: "定时器/计数器", category: "hardware", level: 1 },
                { id: "serial", name: "串行通信", category: "hardware", level: 1 },
                { id: "application", name: "系统应用", category: "application", level: 1 },
                { id: "c51", name: "C51程序设计", category: "software", level: 1 },
                { id: "proteus", name: "Proteus仿真", category: "tool", level: 1 },
                { id: "keil", name: "Keil开发环境", category: "tool", level: 1 },
                
                // 实验项目节点
                { id: "exp1", name: "实验1: LED流水灯", category: "experiment", level: 2 },
                { id: "exp2", name: "实验2: 数码管计数显示", category: "experiment", level: 2 },
                { id: "exp3", name: "实验3: 文献检索与综述", category: "experiment", level: 2 },
                { id: "exp4", name: "实验4: 电子秒表显示器", category: "experiment", level: 2 },
                { id: "exp5", name: "实验5: 电子表LCD显示", category: "experiment", level: 2 },
                { id: "exp6", name: "实验6: 18B20温度检测", category: "experiment", level: 2 },
                { id: "exp7", name: "实验7: 直流数字电压表", category: "experiment", level: 2 },
                { id: "exp8", name: "实验8: 双机串行通信", category: "experiment", level: 2 },
                { id: "proj1", name: "项目1: 智能交通灯", category: "project", level: 2 },
                { id: "proj2", name: "项目2: 综合应用系统", category: "project", level: 2 },
                
                // 基础概念子节点
                { id: "architecture", name: "体系结构", category: "hardware", level: 2 },
                { id: "pin", name: "引脚功能", category: "hardware", level: 2 },
                { id: "clock", name: "时钟电路", category: "hardware", level: 2 },
                { id: "reset", name: "复位电路", category: "hardware", level: 2 },
                { id: "minimal_system", name: "最小系统", category: "hardware", level: 2 },
                
                // 存储器系统子节点
                { id: "rom", name: "程序存储器", category: "hardware", level: 2 },
                { id: "ram", name: "数据存储器", category: "hardware", level: 2 },
                { id: "sfr", name: "特殊功能寄存器", category: "hardware", level: 2 },
                { id: "expansion", name: "存储器扩展", category: "hardware", level: 2 },
                { id: "bit_addressable", name: "位寻址区", category: "hardware", level: 3 },
                { id: "byte_addressable", name: "字节寻址区", category: "hardware", level: 3 },
                
                // I/O端口子节点
                { id: "p0", name: "P0口", category: "hardware", level: 2 },
                { id: "p1", name: "P1口", category: "hardware", level: 2 },
                { id: "p2", name: "P2口", category: "hardware", level: 2 },
                { id: "p3", name: "P3口", category: "hardware", level: 2 },
                { id: "port_structure", name: "端口结构", category: "hardware", level: 3 },
                { id: "port_application", name: "端口应用", category: "hardware", level: 3 },
                
                // 指令系统子节点
                { id: "addressing", name: "寻址方式", category: "software", level: 2 },
                { id: "data", name: "数据传送", category: "software", level: 2 },
                { id: "arithmetic", name: "算术运算", category: "software", level: 2 },
                { id: "logic", name: "逻辑运算", category: "software", level: 2 },
                { id: "control", name: "控制转移", category: "software", level: 2 },
                { id: "bit_operation", name: "位操作", category: "software", level: 2 },
                
                // 中断系统子节点
                { id: "sources", name: "中断源", category: "hardware", level: 2 },
                { id: "priority", name: "中断优先级", category: "hardware", level: 2 },
                { id: "response", name: "中断响应", category: "hardware", level: 2 },
                { id: "service", name: "中断服务", category: "software", level: 2 },
                { id: "ie_register", name: "中断允许寄存器", category: "hardware", level: 3 },
                { id: "ip_register", name: "中断优先级寄存器", category: "hardware", level: 3 },
                
                // 定时器子节点
                { id: "t0", name: "定时器0", category: "hardware", level: 2 },
                { id: "t1", name: "定时器1", category: "hardware", level: 2 },
                { id: "modes", name: "工作方式", category: "hardware", level: 2 },
                { id: "calculation", name: "初值计算", category: "software", level: 2 },
                { id: "tmod_register", name: "TMOD寄存器", category: "hardware", level: 3 },
                { id: "tcon_register", name: "TCON寄存器", category: "hardware", level: 3 },
                
                // 串行通信子节点
                { id: "structure", name: "串行口结构", category: "hardware", level: 2 },
                { id: "serial_modes", name: "工作方式", category: "hardware", level: 2 },
                { id: "baud", name: "波特率", category: "software", level: 2 },
                { id: "multi", name: "多机通信", category: "application", level: 2 },
                { id: "scon_register", name: "SCON寄存器", category: "hardware", level: 3 },
                { id: "sbuf_register", name: "SBUF寄存器", category: "hardware", level: 3 },
                
                // C51程序设计子节点
                { id: "c51_basics", name: "C51基础", category: "software", level: 2 },
                { id: "data_types", name: "数据类型", category: "software", level: 2 },
                { id: "storage_classes", name: "存储类别", category: "software", level: 2 },
                { id: "sfr_access", name: "SFR访问", category: "software", level: 2 },
                { id: "interrupt_functions", name: "中断函数", category: "software", level: 2 },
                { id: "pointers", name: "指针", category: "software", level: 2 },
                { id: "code_optimization", name: "代码优化", category: "software", level: 2 },
                
                // 应用子节点
                { id: "minimal", name: "最小系统", category: "application", level: 2 },
                { id: "external", name: "系统扩展", category: "application", level: 2 },
                { id: "interface", name: "接口技术", category: "application", level: 2 },
                { id: "design", name: "系统设计", category: "application", level: 2 },
                
                // 实际应用节点
                { id: "led", name: "LED控制", category: "application", level: 3 },
                { id: "keyboard", name: "键盘接口", category: "application", level: 3 },
                { id: "display", name: "显示接口", category: "application", level: 3 },
                { id: "adc", name: "A/D转换", category: "application", level: 3 },
                { id: "motor", name: "电机控制", category: "application", level: 3 },
                { id: "temp", name: "温度检测", category: "application", level: 3 },
                { id: "pwm", name: "PWM输出", category: "application", level: 3 },
                
                // 新增实验相关节点
                { id: "led_display", name: "LED显示", category: "hardware", level: 3 },
                { id: "seven_segment", name: "七段数码管", category: "hardware", level: 3 },
                { id: "lcd1602", name: "LCD1602液晶", category: "hardware", level: 3 },
                { id: "ds18b20", name: "DS18B20传感器", category: "hardware", level: 3 },
                { id: "adc0809", name: "ADC0809转换器", category: "hardware", level: 3 },
                { id: "matrix_keyboard", name: "矩阵键盘", category: "hardware", level: 3 },
                { id: "stopwatch", name: "秒表功能", category: "application", level: 3 },
                { id: "voltmeter", name: "电压表设计", category: "application", level: 3 },
                { id: "multi_mcu", name: "多机通信", category: "application", level: 3 },
                { id: "literature_review", name: "文献综述", category: "software", level: 3 }
            ],
            links: [
                // 核心概念关联
                { source: "mcs51", target: "basic" },
                { source: "mcs51", target: "memory" },
                { source: "mcs51", target: "io" },
                { source: "mcs51", target: "instruction" },
                { source: "mcs51", target: "interrupt" },
                { source: "mcs51", target: "timer" },
                { source: "mcs51", target: "serial" },
                { source: "mcs51", target: "application" },
                { source: "mcs51", target: "c51" },
                { source: "mcs51", target: "proteus" },
                { source: "mcs51", target: "keil" },
                
                // 实验项目关联到课程
                { source: "mcs51", target: "exp1" },
                { source: "mcs51", target: "exp2" },
                { source: "mcs51", target: "exp3" },
                { source: "mcs51", target: "exp4" },
                { source: "mcs51", target: "exp5" },
                { source: "mcs51", target: "exp6" },
                { source: "mcs51", target: "exp7" },
                { source: "mcs51", target: "exp8" },
                { source: "mcs51", target: "proj1" },
                { source: "mcs51", target: "proj2" },
                
                // 实验1: LED流水灯关联
                { source: "exp1", target: "io" },
                { source: "exp1", target: "led" },
                { source: "exp1", target: "timer" },
                { source: "exp1", target: "c51" },
                { source: "exp1", target: "proteus" },
                { source: "exp1", target: "keil" },
                { source: "exp1", target: "led_display" },
                { source: "led", target: "led_display" },
                
                // 实验2: 数码管计数显示关联
                { source: "exp2", target: "io" },
                { source: "exp2", target: "display" },
                { source: "exp2", target: "interrupt" },
                { source: "exp2", target: "keyboard" },
                { source: "exp2", target: "seven_segment" },
                { source: "display", target: "seven_segment" },
                
                // 实验3: 文献检索与综述关联
                { source: "exp3", target: "literature_review" },
                { source: "exp3", target: "application" },
                { source: "literature_review", target: "c51" },
                { source: "literature_review", target: "proteus" },
                
                // 实验4: 电子秒表显示器关联
                { source: "exp4", target: "timer" },
                { source: "exp4", target: "io" },
                { source: "exp4", target: "display" },
                { source: "exp4", target: "stopwatch" },
                { source: "timer", target: "stopwatch" },
                { source: "display", target: "seven_segment" },
                
                // 实验5: 电子表LCD显示关联
                { source: "exp5", target: "lcd1602" },
                { source: "exp5", target: "timer" },
                { source: "exp5", target: "io" },
                { source: "exp5", target: "keyboard" },
                { source: "display", target: "lcd1602" },
                
                // 实验6: 18B20温度检测关联
                { source: "exp6", target: "ds18b20" },
                { source: "exp6", target: "lcd1602" },
                { source: "exp6", target: "temp" },
                { source: "temp", target: "ds18b20" },
                
                // 实验7: 直流数字电压表设计关联
                { source: "exp7", target: "adc0809" },
                { source: "exp7", target: "display" },
                { source: "exp7", target: "adc" },
                { source: "exp7", target: "voltmeter" },
                { source: "adc", target: "adc0809" },
                { source: "adc", target: "voltmeter" },
                
                // 实验8: 双机串行通信设计关联
                { source: "exp8", target: "serial" },
                { source: "exp8", target: "io" },
                { source: "exp8", target: "display" },
                { source: "exp8", target: "keyboard" },
                { source: "exp8", target: "multi_mcu" },
                { source: "serial", target: "multi_mcu" },
                
                // 项目1: 智能交通灯关联
                { source: "proj1", target: "io" },
                { source: "proj1", target: "timer" },
                { source: "proj1", target: "interrupt" },
                { source: "proj1", target: "led" },
                { source: "proj1", target: "design" },
                { source: "proj1", target: "application" },
                
                // 项目2: 综合应用系统关联
                { source: "proj2", target: "application" },
                { source: "proj2", target: "design" },
                
                // 基础概念子关联
                { source: "basic", target: "architecture" },
                { source: "basic", target: "pin" },
                { source: "basic", target: "clock" },
                { source: "basic", target: "reset" },
                { source: "basic", target: "minimal_system" },
                { source: "basic", target: "minimal" },
                
                // 存储器系统子关联
                { source: "memory", target: "rom" },
                { source: "memory", target: "ram" },
                { source: "memory", target: "sfr" },
                { source: "memory", target: "expansion" },
                { source: "sfr", target: "ie_register" },
                { source: "sfr", target: "ip_register" },
                { source: "sfr", target: "tmod_register" },
                { source: "sfr", target: "tcon_register" },
                { source: "sfr", target: "scon_register" },
                { source: "sfr", target: "sbuf_register" },
                { source: "rom", target: "byte_addressable" },
                { source: "ram", target: "bit_addressable" },
                { source: "ram", target: "byte_addressable" },

                // I/O端口子关联
                { source: "io", target: "p0" },
                { source: "io", target: "p1" },
                { source: "io", target: "p2" },
                { source: "io", target: "p3" },
                { source: "p0", target: "port_structure" },
                { source: "p1", target: "port_structure" },
                { source: "p2", target: "port_structure" },
                { source: "p3", target: "port_structure" },

                // 指令系统子关联
                { source: "instruction", target: "addressing" },
                { source: "instruction", target: "data" },
                { source: "instruction", target: "arithmetic" },
                { source: "instruction", target: "logic" },
                { source: "instruction", target: "control" },
                { source: "instruction", target: "bit_operation" },

                // 中断系统子关联
                { source: "interrupt", target: "sources" },
                { source: "interrupt", target: "priority" },
                { source: "interrupt", target: "response" },
                { source: "interrupt", target: "service" },
                { source: "interrupt", target: "ie_register" },
                { source: "interrupt", target: "ip_register" },

                // 定时器子关联
                { source: "timer", target: "t0" },
                { source: "timer", target: "t1" },
                { source: "timer", target: "modes" },
                { source: "timer", target: "calculation" },
                { source: "timer", target: "tmod_register" },
                { source: "timer", target: "tcon_register" },

                // 串行通信子关联
                { source: "serial", target: "structure" },
                { source: "serial", target: "serial_modes" },
                { source: "serial", target: "baud" },
                { source: "serial", target: "multi" },
                { source: "serial", target: "scon_register" },
                { source: "serial", target: "sbuf_register" },

                // C51程序设计子关联
                { source: "c51", target: "c51_basics" },
                { source: "c51", target: "data_types" },
                { source: "c51", target: "storage_classes" },
                { source: "c51", target: "sfr_access" },
                { source: "c51", target: "interrupt_functions" },
                { source: "c51", target: "pointers" },
                { source: "c51", target: "code_optimization" },

                // 应用子关联
                { source: "application", target: "minimal" },
                { source: "application", target: "external" },
                { source: "application", target: "interface" },
                { source: "application", target: "design" },
                { source: "interface", target: "led" },
                { source: "interface", target: "keyboard" },
                { source: "interface", target: "display" },
                { source: "interface", target: "adc" },
                { source: "interface", target: "motor" },
                { source: "interface", target: "temp" },
                { source: "interface", target: "pwm" },
                { source: "display", target: "led_display" },
                { source: "display", target: "seven_segment" },
                { source: "display", target: "lcd1602" },
                { source: "keyboard", target: "matrix_keyboard" }
            ]
        };

        // 节点详细信息 - 添加实验项目的详细信息
        const nodeDetails = {
            "mcs51": {
                title: "MCS51单片机",
                description: "Intel公司推出的8位单片机系列，是应用最广泛的单片机之一。",
                content: `
                    <div class="detail-item">
                        <h4>基本特性</h4>
                        <ul>
                            <li>8位CPU，基于哈佛架构</li>
                            <li>4KB片内程序存储器（ROM）</li>
                            <li>128B片内数据存储器（RAM）</li>
                            <li>32根I/O线（4个8位并行端口）</li>
                            <li>2个16位定时器/计数器</li>
                            <li>5个中断源，2个优先级</li>
                            <li>全双工串行通信口</li>
                            <li>64KB外部程序存储器寻址能力</li>
                            <li>64KB外部数据存储器寻址能力</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>主要型号</h4>
                        <ul>
                            <li>8031 - 无片内ROM</li>
                            <li>8051 - 4KB掩膜ROM</li>
                            <li>8751 - 4KB EPROM</li>
                            <li>89C51 - 4KB Flash ROM</li>
                        </ul>
                    </div>
                    <div class="learning-path">
                        <h5>学习路径建议</h5>
                        <p>初学者建议按照以下顺序学习：</p>
                        <ol>
                            <li>先学习单片机基础概念和体系结构</li>
                            <li>掌握C51编程语言基础</li>
                            <li>了解Keil开发环境的使用</li>
                            <li>学习Proteus仿真方法</li>
                            <li>逐步深入各个功能模块</li>
                        </ol>
                    </div>
                `
            },
            "exp1": {
                title: "实验1: LED流水灯",
                description: "基础GPIO控制实验，学习LED控制和按键检测。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>P0口接八个红色发光LED</li>
                            <li>P1.0,P1.1,P1.2分别接三个按键</li>
                            <li>上电后流水灯自上往下，延时2秒闪烁</li>
                            <li>P1.0按键控制流水灯工作模式切换</li>
                            <li>P1.1按键增加闪烁时延，P1.2按键减少闪烁时延</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>GPIO输入输出控制</li>
                            <li>按键检测与消抖</li>
                            <li>延时程序设计</li>
                            <li>Proteus电路仿真</li>
                            <li>Keil C51编程</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>实验目标</h4>
                        <p>掌握单片机基本I/O口的使用方法，学会编写简单的控制程序。</p>
                    </div>
                `
            },
            "exp2": {
                title: "实验2: 数码管计数显示",
                description: "学习数码管显示和中断应用。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>P1、P2口分别接共阴极八段数码管</li>
                            <li>实现00~99的显示</li>
                            <li>P3.2、P3.3分别接加一和减一按键</li>
                            <li>使用按键轮询方式或中断方式完成按键检测</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>七段数码管显示原理</li>
                            <li>动态显示技术</li>
                            <li>外部中断应用</li>
                            <li>按键检测与处理</li>
                        </ul>
                    </div>
                `
            },
            "exp3": {
                title: "实验3: 单片机专业文献检索与综述",
                description: "学习专业文献检索和综述撰写。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>利用图书纸质期刊资源与CNKI等电子资源</li>
                            <li>进行专业前沿与开发系统所需文献的查找</li>
                            <li>形成关于特定主题的文献综述</li>
                            <li>用海报形式进行展示</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>专业文献检索方法</li>
                            <li>文献综述撰写技巧</li>
                            <li>单片机应用前沿技术</li>
                        </ul>
                    </div>
                `
            },
            "exp4": {
                title: "实验4: 电子秒表显示器",
                description: "使用定时器中断实现秒表功能。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>P0口接两个共阴数码管显示分秒</li>
                            <li>P3.2接启动/暂停按键</li>
                            <li>P3.3接清零按键</li>
                            <li>利用定时器中断实现精确计时</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>定时器中断应用</li>
                            <li>数码管动态扫描</li>
                            <li>按键状态检测</li>
                        </ul>
                    </div>
                `
            },
            "exp5": {
                title: "实验5: 电子表LCD显示",
                description: "使用LCD1602液晶显示电子时钟。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>使用LCD1602显示时、分、秒</li>
                            <li>P3.2接按键调整时间</li>
                            <li>实现时间走时、设置功能</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>LCD1602液晶驱动原理</li>
                            <li>定时器中断</li>
                            <li>按键矩阵扫描</li>
                        </ul>
                    </div>
                `
            },
            "exp6": {
                title: "实验6: 18B20温度检测",
                description: "使用DS18B20数字温度传感器和LCD显示。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>单片机P3.7口接DS18B20温度传感器</li>
                            <li>通过单总线读取温度数据</li>
                            <li>在LCD1602上显示实时温度</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>单总线通信协议</li>
                            <li>DS18B20传感器原理</li>
                            <li>温度数据处理与显示</li>
                        </ul>
                    </div>
                `
            },
            "exp7": {
                title: "实验7: 直流数字电压表",
                description: "使用ADC0809模数转换器实现电压测量。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>ADC0808/0809的IN0通道输入模拟电压</li>
                            <li>单片机控制ADC转换，读取数字量</li>
                            <li>将数字量换算为电压值</li>
                            <li>在LCD1602上显示电压值</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>A/D转换原理</li>
                            <li>ADC0809接口技术</li>
                            <li>电压校准与计算</li>
                        </ul>
                    </div>
                `
            },
            "exp8": {
                title: "实验8: 双机串行通信",
                description: "实现两片单片机之间的串口通信。",
                content: `
                    <div class="detail-item">
                        <h4>实验内容</h4>
                        <ul>
                            <li>单片机A发送数据（如0-255计数值）</li>
                            <li>单片机B接收数据并在数码管上显示</li>
                            <li>实现两机间的双向通信</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>串口通信协议（UART）</li>
                            <li>波特率设置</li>
                            <li>中断方式收发数据</li>
                        </ul>
                    </div>
                `
            },
            "proj1": {
                title: "项目1: 智能交通灯",
                description: "综合应用项目，实现智能交通灯控制系统。",
                content: `
                    <div class="detail-item">
                        <h4>项目内容</h4>
                        <ul>
                            <li>设计智能交通灯控制系统</li>
                            <li>实现红绿灯定时控制</li>
                            <li>添加紧急车辆优先通行功能</li>
                            <li>实现人行横道按钮控制</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>单片机最小系统设计</li>
                            <li>定时器应用</li>
                            <li>中断系统</li>
                            <li>I/O口控制</li>
                            <li>系统综合设计</li>
                        </ul>
                    </div>
                `
            },
            "proj2": {
                title: "项目2: 综合应用系统",
                description: "完成一个完整的单片机应用系统设计与实现。",
                content: `
                    <div class="detail-item">
                        <h4>项目内容</h4>
                        <ul>
                            <li>从需求分析开始，到最终系统实现</li>
                            <li>包含硬件原理图设计与PCB绘制（使用Proteus ARES）</li>
                            <li>软件模块化设计与编码（使用Keil C51）</li>
                            <li>功能仿真与硬件调试</li>
                            <li>编写完整的设计文档</li>
                        </ul>
                    </div>
                    <div class="detail-item">
                        <h4>涉及知识点</h4>
                        <ul>
                            <li>系统设计方法论</li>
                            <li>硬件/软件协同设计</li>
                            <li>Proteus与Keil联合仿真调试</li>
                            <li>项目管理与文档撰写</li>
                        </ul>
                    </div>
                `
            }
        };

        // 指定宽和高，但实际绘制时使用容器的宽高
        const width = 960;
        const height = 600;

        const svg = d3.select("#knowledge-graph")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("preserveAspectRatio", "xMidYMid meet");

        const g = svg.append("g");

        // 创建缩放行为
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // 创建力导向模拟
        const simulation = d3.forceSimulation(knowledgeData.nodes)
            .force("link", d3.forceLink(knowledgeData.links).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(30));

        // 创建箭头标记
        svg.append("defs").selectAll("marker")
            .data(["end"])
            .enter().append("marker")
            .attr("id", String)
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 25) // 箭头距离节点的距离
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("class", "arrowhead")
            .style("fill", "999");

        // 绘制连线
        const link = g.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(knowledgeData.links)
            .enter().append("line")
            .attr("class", "link")
            .attr("marker-end", "url(#end)");

        // 创建拖拽行为
        const drag = d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended);

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // 绘制节点
        const node = g.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(knowledgeData.nodes)
            .enter().append("circle")
            .attr("class", d => `node ${d.category}`)
            .attr("r", d => 15 - d.level * 2)
            .call(drag)
            .on("click", (event, d) => showNodeDetails(d))
            .on("dblclick", resetHighlight);

        // 添加节点标签
        const label = g.append("g")
            .attr("class", "labels")
            .selectAll("text")
            .data(knowledgeData.nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .text(d => d.name)
            .attr("dy", "0.31em");

        // 更新力导向图
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            label
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });

        // 显示节点详情
        function showNodeDetails(nodeData) {
            const defaultInfo = document.getElementById("default-info");
            const nodeDetailsDiv = document.getElementById("node-details");
            
            defaultInfo.style.display = "none";
            nodeDetailsDiv.style.display = "block";

            let detailsHTML = `<h3 class="info-title">${nodeData.name}</h3>`;
            detailsHTML += `<p><strong>类别:</strong> ${getCategoryName(nodeData.category)}</p>`;
            detailsHTML += `<p><strong>层级:</strong> ${nodeData.level}</p>`;

            if (nodeDetails[nodeData.id]) {
                detailsHTML += nodeDetails[nodeData.id].content;
            } else {
                detailsHTML += `<div class="detail-item"><p>暂无该节点的详细描述。</p></div>`;
            }
            
            nodeDetailsDiv.innerHTML = detailsHTML;

            // 高亮相关节点和连线
            highlightRelatedNodes(nodeData.id);
        }

        function getCategoryName(category) {
            const categoryMap = {
                "core": "核心概念",
                "hardware": "硬件知识",
                "software": "软件知识",
                "tool": "开发工具",
                "application": "实际应用",
                "experiment": "实验项目",
                "project": "综合项目"
            };
            return categoryMap[category] || category;
        }

        function highlightRelatedNodes(nodeId) {
            const relatedNodeIds = new Set([nodeId]);
            const relatedLinkIds = new Set();

            knowledgeData.links.forEach((link, index) => {
                if (link.source.id === nodeId || link.target.id === nodeId) {
                    relatedLinkIds.add(index);
                    relatedNodeIds.add(link.source.id);
                    relatedNodeIds.add(link.target.id);
                }
            });

            node.classed("highlighted", d => relatedNodeIds.has(d.id));
            link.classed("highlighted", (d, i) => relatedLinkIds.has(i));
        }

        function resetHighlight() {
            node.classed("highlighted", false);
            link.classed("highlighted", false);

            document.getElementById("default-info").style.display = "block";
            document.getElementById("node-details").style.display = "none";
        }

        // 搜索功能
        document.getElementById("search-input").addEventListener("input", (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            node.style("opacity", d => {
                if (searchTerm === "") return 1;
                return d.name.toLowerCase().includes(searchTerm) ? 1 : 0.1;
            });
            
            label.style("opacity", d => {
                if (searchTerm === "") return 1;
                return d.name.toLowerCase().includes(searchTerm) ? 1 : 0.1;
            });

            link.style("opacity", d => {
                if (searchTerm === "") return 0.6;
                const sourceMatch = d.source.name.toLowerCase().includes(searchTerm);
                const targetMatch = d.target.name.toLowerCase().includes(searchTerm);
                return (sourceMatch && targetMatch) ? 1 : 0.1;
            });
        });

        // 重置视图
        document.getElementById("reset-graph").addEventListener("click", () => {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
            resetHighlight();
            document.getElementById("search-input").value = "";
            node.style("opacity", 1);
            label.style("opacity", 1);
            link.style("opacity", 0.6);
        });

        // 放大
        document.getElementById("zoom-in").addEventListener("click", () => {
            svg.transition().duration(300).call(
                zoom.scaleBy,
                1.5
            );
        });

        // 缩小
        document.getElementById("zoom-out").addEventListener("click", () => {
            svg.transition().duration(300).call(
                zoom.scaleBy,
                1 / 1.5
            );
        });

        // 显示/隐藏标签
        document.getElementById("toggle-labels").addEventListener("click", () => {
            label.classed("hidden", !label.classed("hidden"));
        });

        // 页面加载完成后初始化知识图谱
        document.addEventListener('DOMContentLoaded', function() {
            // 确保内容加载完成
            simulation.alpha(1).restart();
        });
    </script>
</body>
</html>